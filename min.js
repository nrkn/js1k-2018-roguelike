(()=>{t=l=>Math.random()*l|0,e=0,f=[0,0,0,10,"@","#39f"],r=(l,t)=>{for(let e=0;e<l.length;e++)if(l[e][3]&&t[0]==l[e][0]&&t[1]==l[e][1])return l[e]},h=(l,t,e,f)=>{f?l[0]<t[0]?t[0]--:l[0]>t[0]?t[0]++:l[1]<t[1]?t[1]--:l[1]>t[1]&&t[1]++:1==e?t[1]--:2==e?t[0]++:3==e?t[1]++:t[0]--},o=()=>{l=[[[f[0],f[1],3,1,".","#aaa"]],[f]];let a=t(10*e)+10,o=t(10*e)+10,i=t(2*e)+2,n=t(2*e)+2,u=t(2*e)+2,c=(e,f,h,i)=>{let n=[t(a),t(o),e,f,h,i];return r(l[0],n)&&!r(l[1],n)?(l[1].push(n),n):c(e,f,h,i)},d=(e,f)=>{if(r(l[0],f)||l[0].push([f[0],f[1],3,1,".","#aaa"]),e[0]==f[0]&&e[1]==f[1])return;let a=t(4);h(e,f,a,!t(3)),d(e,f)};for(let e=0;e<i;e++)d(l[0][t(l[0].length)],[t(a),t(o)]);c(2,1,e>8?"$":">",e>8?"#39f":"#000");for(let l=0;l<n;l++)c(1,1,"m","#f00");for(let l=0;l<u;l++)c(4,1,"¢","#f90")},i=()=>{a.width=a.width;let t=f[3]<1,h=e>9;for(let e=0;e<25;e++)for(let a=0;a<25;a++){let o=f[0]-12+a,i=f[1]-12+e,n=r(l[1],[o,i])||r(l[0],[o,i]);n||(l[1].push([o,i,5,1,"#","#aaa"]),n=r(l[1],[o,i])),a>=8&&e>=8&&a<17&&e<17&&(n[6]=1),c.fillStyle=t||h?"#39f":n[5],c.fillText(h?"$":t?0:n[6]?n[4]:" ",10*a,10*e)}t||h||(c.fillStyle="#000",c.fillText(1+e+" ¢"+f[3],0,250))},n=(a,i)=>{let n=[a[0],a[1]];h(f,n,i,1==a[2]&&t(5));let u=r(l[1],n);u&&1==a[2]&&0==u[2]&&t(2)?u[3]--:u&&0==a[2]&&1==u[2]&&t(2)?u[3]--:u&&0==a[2]&&2==u[2]?(e++,o()):u&&4==u[2]?(a[3]++,u[3]--):r(l[0],n)&&!u&&(a[0]=n[0],a[1]=n[1])};b.onkeydown=(e=>{n(f,e.which-37);for(let e=0;e<l[1].length;e++)l[1][e][3]&&1==l[1][e][2]&&n(l[1][e],t(4));i()}),o(),i()})()